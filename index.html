<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Prompting Quiz</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#87CEEB;
      --card:#ffffff;
      --accent:#0b66ff;
      --muted:#6b7280;
      --success:#16a34a;
      --danger:#dc2626;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .container{width:100%;max-width:820px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 6px 20px rgba(12,15,30,0.06);padding:28px}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-success{background:var(--success);color:#fff}
    .btn-ghost{background:transparent;border:1px solid #e6eefb;color:var(--accent)}
    .form-row{display:flex;gap:12px;margin-bottom:12px}
    .input, .select{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eefb}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .timer{background:#eef6ff;padding:8px 12px;border-radius:10px;color:var(--accent);font-weight:600}
    .question-card{padding:18px;border-radius:10px;border:1px solid #eef6ff}
    .options{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .option{padding:10px;border-radius:8px;border:1px solid #f1f5f9;cursor:pointer}
    .option input{margin-right:10px}
    .nav{display:flex;justify-content:space-between;margin-top:16px}
    .small{font-size:13px;color:var(--muted)}
    .result{padding:18px;border-radius:10px;background:#fbfbff;border:1px solid #eef2ff}
    .correct{color:var(--success);font-weight:700}
    .wrong{color:var(--danger);font-weight:700}
    .answer-list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .qa{padding:12px;border-radius:8px;border:1px solid #f1f5f9;background:white}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    footer{margin-top:12px;text-align:center;font-size:13px;color:var(--muted)}
    .copyright{margin-top:20px;text-align:center;font-size:12px;color:var(--muted);padding-top:16px;border-top:1px solid #e6eefb}
    .share-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center}
    .share-modal.active{display:flex}
    .share-content{background:white;padding:24px;border-radius:12px;max-width:500px;width:90%}
    .share-link{background:#f8f9fa;padding:12px;border-radius:8px;word-break:break-all;margin:12px 0;font-size:14px}
    @media (max-width:640px){.form-row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="app">
      <!-- INTRO -->
      <div id="intro">
        <h1>Welcome to the AI Prompting Quiz</h1>
        <p class="lead">You have <strong>15 minutes</strong> to complete 15 questions. Answer one question at a time. Your result will be presented when you finish or when time runs out.</p>
        <div style="display:flex;gap:8px;margin-top:18px">
          <button class="btn btn-primary" id="startButton">Start Quiz</button>
          <button class="btn btn-ghost" id="instructionsBtn">View Instructions</button>
        </div>
      </div>

      <!-- INSTRUCTIONS / FORM -->
      <div id="formWrap" style="display:none;margin-top:12px">
        <h2 style="font-size:16px;margin-bottom:6px">Enter your details</h2>
        <p class="small">Please provide your full name, department, and organisation. Date is auto-filled but editable.</p>
        <div style="margin-top:12px">
          <div style="margin-bottom:10px">
            <label>Full name</label>
            <input id="fullName" class="input" placeholder="e.g. Jane Doe" />
          </div>
          <div style="margin-bottom:10px">
            <label>Department</label>
            <input id="department" class="input" placeholder="e.g. IT, HR, Finance" />
          </div>
          <div style="margin-bottom:10px">
            <label>Organisation</label>
            <input id="orgName" class="input" placeholder="e.g. WRPC" />
          </div>
          <div style="margin-bottom:10px">
            <label>Date</label>
            <input id="dateField" class="input" type="date" />
          </div>
          <div>
            <button class="btn btn-primary" id="beginBtn">Begin Quiz</button>
            <button class="btn" id="backToIntro">Back</button>
          </div>
        </div>
      </div>

      <!-- QUIZ -->
      <div id="quizWrap" style="display:none;margin-top:12px">
        <div class="topbar">
          <div>
            <div class="small meta" id="userMeta"></div>
          </div>
          <div class="timer" id="timer">15:00</div>
        </div>

        <div class="question-card">
          <div id="questionText"><strong>Question</strong></div>
          <div class="options" id="optionsBox"></div>
        </div>

        <div class="nav">
          <div>
            <button class="btn" id="prevBtn">Previous</button>
          </div>
          <div>
            <button class="btn" id="submitBtn">Submit Quiz</button>
            <button class="btn btn-primary" id="nextBtn">Next</button>
          </div>
        </div>

      </div>

      <!-- RESULTS -->
      <div id="resultWrap" style="display:none;margin-top:12px">
        <h2>Quiz Result</h2>
        <div class="result" id="resultCard">
          <div class="meta" id="resultMeta"></div>
          <div style="margin-top:8px;font-size:18px" id="scoreText"></div>
          <div class="answer-list" id="answerList"></div>
          <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn btn-primary" id="downloadBtn">Download Result as PDF</button>
            <button class="btn btn-success" id="shareBtn">Share Result</button>
            <button class="btn" id="retakeBtn">Retake Quiz</button>
          </div>
        </div>
      </div>

      <div class="copyright">
        &copy; Copyright 2025 Suleiman Shaibu
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div class="share-modal" id="shareModal">
    <div class="share-content">
      <h3 style="margin-top:0">Share Quiz Result</h3>
      <p>Share this link to show your quiz result (answers not included):</p>
      <div class="share-link" id="shareLink"></div>
      <div style="display:flex;gap:8px;margin-top:16px">
        <button class="btn btn-primary" id="copyLinkBtn">Copy Link</button>
        <button class="btn" id="closeModalBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Libraries for PDF capture -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Firebase SDK and Main Script -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase configuration - REPLACE WITH YOUR CONFIG
    const firebaseConfig = {
  apiKey: "AIzaSyB2UgTnlToaG15CoUVfhHXON6wjo3pqVEA",
  authDomain: "aipromptingquiz.firebaseapp.com",
  projectId: "aipromptingquiz",
  storageBucket: "aipromptingquiz.firebasestorage.app",
  messagingSenderId: "801185668348",
  appId: "1:801185668348:web:80230c6d458c7bd18fcb79",
  measurementId: "G-V2YYR06KKX"
};


    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Questions array
    const quiz = [
      {q: 'What is a question prompt?', opts:['A) A prompt that tells the AI to do something specific','B) A prompt that asks a question to the AI','C) A prompt that starts a sentence for the AI to finish'], ans:1},
      {q: 'Which prompt type involves starting a sentence and letting the AI finish it?', opts:['A) Instruction prompt','B) Completion prompt','C) Comparison prompt'], ans:1},
      {q: 'What is an example of a comparison prompt?', opts:['A) "What\'s the biggest animal in the world?"','B) "Write a short poem about a butterfly."','C) "What are the differences between a cat and a dog?"'], ans:2},
      {q: 'Which prompt type asks the AI to explain something in detail?', opts:['A) Explanation prompt','B) Creative prompt','C) Role-play prompt'], ans:0},
      {q: 'What is an example of a creative prompt?', opts:['A) "Explain how a bicycle works."','B) "Invent a new ice cream flavor and describe how it tastes."','C) "Pretend you\'re a pirate, how would you talk?"'], ans:1},
      {q: 'Which prompt type involves asking the AI to pretend to be someone or something else?', opts:['A) Problem-solving prompt','B) Role-play prompt','C) Instruction prompt'], ans:1},
      {q: 'What is an example of a problem-solving prompt?', opts:['A) "How can I remember to brush my teeth every night?"','B) "What\'s the biggest animal in the world?"','C) "Write a short poem about a butterfly."'], ans:0},
      {q: 'What does the acronym CRAFT stand for in crafting good prompts?', opts:['A) Context, Role, Action, Format, Target & Tone','B) Context, Role, Action, Format, Time','C) Context, Role, Action, Format, Theme'], ans:0},
      {q: 'What should you consider when prompting with priming?', opts:['A) The AI\'s previous responses','B) The context, goals, and objectives','C) The AI\'s ability to read your mind'], ans:1},
      {q: 'What is the purpose of customizing your ChatGPT?', opts:['A) To make it more expensive','B) To make it respond in a way that suits your needs','C) To make it less responsive'], ans:1},
      {q: 'How do you train your LLM (not ChatGPT)?', opts:['A) Save a template and type it at the beginning of every conversation','B) Ignore previous contexts','C) Avoid asking for specific personas'], ans:0},
      {q: 'What should you do if you had a detailed conversation before but you started a new set of discussions (totally different) subsequently and you suddenly want your LLM to give you an answer about an area of the same topic?', opts:['A) Start a new conversation without referencing the previous one','B) Briefly refer back to the previous context','C) Change the topic completely'], ans:1},
      {q: 'What is an example of a well-crafted prompt?', opts:['A) "How should I spend my weekend?"','B) "Create a fictional case study on change management for a government financial institution"','C) "What\'s the biggest animal in the world?"'], ans:1},
      {q: 'What should you tell the LLM about yourself upfront?', opts:['A) Your favorite color','B) Who you are and your profession','C) Your favorite food'], ans:1},
      {q: 'What is the benefit of sharing your content written in your language and style with the LLM?', opts:['A) It will spot patterns and respond accordingly','B) It will ignore your style','C) It will change your writing style'], ans:0}
    ];

    // State
    let current = 0;
    const answers = new Array(quiz.length).fill(null);
    let timerSeconds = 15 * 60;
    let timerInterval = null;
    let resultId = null;

    // DOM refs
    const intro = document.getElementById('intro');
    const startButton = document.getElementById('startButton');
    const instructionsBtn = document.getElementById('instructionsBtn');
    const formWrap = document.getElementById('formWrap');
    const beginBtn = document.getElementById('beginBtn');
    const backToIntro = document.getElementById('backToIntro');
    const fullName = document.getElementById('fullName');
    const department = document.getElementById('department');
    const orgName = document.getElementById('orgName');
    const dateField = document.getElementById('dateField');
    const quizWrap = document.getElementById('quizWrap');
    const questionText = document.getElementById('questionText');
    const optionsBox = document.getElementById('optionsBox');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const timerEl = document.getElementById('timer');
    const userMeta = document.getElementById('userMeta');
    const resultWrap = document.getElementById('resultWrap');
    const resultMeta = document.getElementById('resultMeta');
    const scoreText = document.getElementById('scoreText');
    const answerList = document.getElementById('answerList');
    const downloadBtn = document.getElementById('downloadBtn');
    const shareBtn = document.getElementById('shareBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const shareModal = document.getElementById('shareModal');
    const shareLink = document.getElementById('shareLink');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');

    // Initialize date
    (function setDate(){
      const today = new Date();
      const iso = today.toISOString().slice(0,10);
      dateField.value = iso;
    })();

    // Check if viewing shared result
    (async function checkSharedResult(){
      const urlParams = new URLSearchParams(window.location.search);
      const sharedId = urlParams.get('result');
      if(sharedId){
        await loadSharedResult(sharedId);
      }
    })();

    async function loadSharedResult(id){
      try{
        const docRef = doc(db, 'quizResults', id);
        const docSnap = await getDoc(docRef);
        
        if(docSnap.exists()){
          const data = docSnap.data();
          intro.style.display = 'none';
          resultWrap.style.display = 'block';
          
          resultMeta.textContent = `${data.name} • ${data.department} • ${data.organisation} • ${data.date}`;
          scoreText.innerHTML = `<strong>Test:</strong> ${data.testName}<br><strong>Score:</strong> ${data.score} out of ${data.totalQuestions}`;
          answerList.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px">Detailed answers are not included in shared results.</p>';
          
          // Hide download and retake buttons for shared view
          downloadBtn.style.display = 'none';
          retakeBtn.style.display = 'none';
          shareBtn.style.display = 'none';
        } else {
          alert('Result not found.');
        }
      } catch(err){
        console.error('Error loading shared result:', err);
        alert('Failed to load shared result: ' + err.message);
      }
    }

    startButton.addEventListener('click',()=>{
      intro.style.display='none';
      formWrap.style.display='block';
    });
    
    instructionsBtn.addEventListener('click',()=>{
      alert('Instructions:\n- You will answer 15 questions in 15 minutes.\n- One question per page.\n- You can navigate back and forth.\n- Timer starts when you click "Begin Quiz".');
    });

    backToIntro.addEventListener('click',()=>{
      formWrap.style.display='none';
      intro.style.display='block';
    });

    beginBtn.addEventListener('click',()=>{
      const name = fullName.value.trim();
      const dept = department.value.trim();
      const org = orgName.value.trim();
      const date = dateField.value;
      if(!name || !dept || !org){
        alert('Please enter your full name, department, and organisation before starting.');
        return;
      }
      formWrap.style.display='none';
      quizWrap.style.display='block';
      userMeta.textContent = `${name} • ${dept} • ${org} • ${date}`;
      startTimer();
      renderQuestion();
    });

    prevBtn.addEventListener('click',()=>{
      saveSelection();
      if(current>0) current--;
      renderQuestion();
    });
    
    nextBtn.addEventListener('click',()=>{
      saveSelection();
      if(current < quiz.length-1) current++;
      renderQuestion();
    });

    submitBtn.addEventListener('click',()=>{
      if(confirm('Submit quiz now?')){
        finishQuiz();
      }
    });

    function renderQuestion(){
      const item = quiz[current];
      questionText.innerHTML = `<strong>Question ${current+1} of ${quiz.length}:</strong> <div style="margin-top:8px">${escapeHtml(item.q)}</div>`;
      optionsBox.innerHTML = '';
      item.opts.forEach((opt,i)=>{
        const id = `opt-${current}-${i}`;
        const div = document.createElement('label');
        div.className='option';
        div.innerHTML = `<input type="radio" name="q${current}" id="${id}" value="${i}" ${answers[current]===i? 'checked' : ''} /> <span>${escapeHtml(opt)}</span>`;
        div.addEventListener('click',()=>{
          const radio = div.querySelector('input');
          radio.checked = true;
          answers[current] = parseInt(radio.value,10);
        });
        optionsBox.appendChild(div);
      });
      prevBtn.disabled = current===0;
      nextBtn.disabled = current===quiz.length-1;
    }

    function saveSelection(){
      const r = document.querySelector(`input[name="q${current}"]:checked`);
      if(r) answers[current] = parseInt(r.value,10);
    }

    function startTimer(){
      if(timerInterval) clearInterval(timerInterval);
      timerSeconds = 15*60;
      updateTimerDisplay();
      timerInterval = setInterval(()=>{
        timerSeconds--;
        updateTimerDisplay();
        if(timerSeconds<=0){
          clearInterval(timerInterval);
          alert('Time is up! Your quiz will be submitted automatically.');
          finishQuiz();
        }
      },1000);
    }

    function updateTimerDisplay(){
      const mm = String(Math.floor(timerSeconds/60)).padStart(2,'0');
      const ss = String(timerSeconds%60).padStart(2,'0');
      timerEl.textContent = `${mm}:${ss}`;
    }

    async function finishQuiz(){
      saveSelection();
      if(timerInterval) clearInterval(timerInterval);
      quizWrap.style.display='none';
      resultWrap.style.display='block';
      await renderResult();
    }

    async function renderResult(){
      const name = fullName.value.trim();
      const dept = department.value.trim();
      const org = orgName.value.trim();
      const date = dateField.value;
      resultMeta.textContent = `${name} • ${dept} • ${org} • ${date}`;
      
      let score = 0;
      answerList.innerHTML='';
      quiz.forEach((item,i)=>{
        const userAns = answers[i];
        const correct = item.ans;
        if(userAns === correct) score++;
        const qa = document.createElement('div');
        qa.className='qa';
        const qh = document.createElement('div');
        qh.innerHTML = `<strong>Q${i+1}.</strong> ${escapeHtml(item.q)}`;
        const details = document.createElement('div');
        details.style.marginTop='8px';
        const uaText = (userAns===null) ? '<em>No answer</em>' : escapeHtml(item.opts[userAns]);
        const correctText = escapeHtml(item.opts[correct]);
        const ua = document.createElement('div');
        ua.innerHTML = `Your answer: ${uaText}`;
        const ca = document.createElement('div');
        ca.innerHTML = `Correct answer: ${correctText}`;
        if(userAns === correct){ ua.className='correct'; ca.className='correct'; }
        else { ua.className='wrong'; ca.className='correct'; }
        details.appendChild(ua);
        details.appendChild(ca);
        qa.appendChild(qh);
        qa.appendChild(details);
        answerList.appendChild(qa);
      });
      scoreText.textContent = `You scored ${score} out of ${quiz.length}`;

      // Save to Firestore
      try{
        const docRef = await addDoc(collection(db, 'quizResults'), {
          name: name,
          department: dept,
          organisation: org,
          date: date,
          score: score,
          totalQuestions: quiz.length,
          testName: 'AI Prompting Introduction',
          timestamp: new Date().toISOString(),
          answers: answers.map((ans, idx) => ({
            question: quiz[idx].q,
            userAnswer: ans !== null ? quiz[idx].opts[ans] : null,
            correctAnswer: quiz[idx].opts[quiz[idx].ans],
            isCorrect: ans === quiz[idx].ans
          }))
        });
        resultId = docRef.id;
        console.log('Quiz result saved with ID:', resultId);
      } catch(err){
        console.error('Error saving to Firestore:', err);
        alert('Note: Result could not be saved to database. Error: ' + err.message);
      }
    }

    shareBtn.addEventListener('click', ()=>{
      if(!resultId){
        alert('Result ID not available. Please complete the quiz first.');
        return;
      }
      const baseUrl = window.location.origin + window.location.pathname;
      const shareUrl = `${baseUrl}?result=${resultId}`;
      shareLink.textContent = shareUrl;
      shareModal.classList.add('active');
    });

    copyLinkBtn.addEventListener('click', ()=>{
      const linkText = shareLink.textContent;
      navigator.clipboard.writeText(linkText).then(()=>{
        alert('Link copied to clipboard!');
      }).catch(()=>{
        const textArea = document.createElement('textarea');
        textArea.value = linkText;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Link copied to clipboard!');
      });
    });

    closeModalBtn.addEventListener('click', ()=>{
      shareModal.classList.remove('active');
    });

    shareModal.addEventListener('click', (e)=>{
      if(e.target === shareModal){
        shareModal.classList.remove('active');
      }
    });

    downloadBtn.addEventListener('click', async ()=>{
      const el = document.getElementById('resultCard');
      downloadBtn.disabled = true;
      shareBtn.disabled = true;
      retakeBtn.disabled = true;
      const { jsPDF } = window.jspdf;
      try{
        const canvas = await html2canvas(el, {scale:2, useCORS:true});
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF({orientation:'portrait',unit:'pt',format:'a4'});
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const imgProps = { width: canvas.width, height: canvas.height };
        const ratio = Math.min(pageWidth / imgProps.width, pageHeight / imgProps.height);
        const imgWidth = imgProps.width * ratio;
        const imgHeight = imgProps.height * ratio;
        pdf.addImage(imgData, 'PNG', (pageWidth - imgWidth)/2, 20, imgWidth, imgHeight);
        pdf.save('quiz-result.pdf');
      }catch(err){
        alert('Failed to generate PDF: '+err.message);
      }finally{
        downloadBtn.disabled = false;
        shareBtn.disabled = false;
        retakeBtn.disabled = false;
      }
    });

    retakeBtn.addEventListener('click',()=>{
      if(!confirm('Retake quiz? This will clear your previous answers.')) return;
      answers.fill(null);
      current = 0;
      timerSeconds = 15*60;
      resultId = null;
      resultWrap.style.display='none';
      formWrap.style.display='block';
    });

    function escapeHtml(str){
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    document.addEventListener('keydown',(e)=>{
      if(e.key === 'ArrowRight') { saveSelection(); if(current < quiz.length-1) { current++; renderQuestion(); } }
      if(e.key === 'ArrowLeft') { saveSelection(); if(current>0) { current--; renderQuestion(); } }
    });

  </script>
</body>
</html>
